(()=>{"use strict";const t={models:["Volvo","Chevrolet","Jaguar","Peugeot","Renault","Mustang","Fiat","Kia","Volkswagen","Nissan"],makes:["Rio","F","Logan","Passat","Lacetti","XC60","GT","Panda","Beetle","308"]};var n=function(t,n,e,r){return new(e||(e=Promise))((function(a,i){function o(t){try{c(r.next(t))}catch(t){i(t)}}function s(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var n;t.done?a(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(o,s)}c((r=r.apply(t,n||[])).next())}))},e=function(t,n){var e,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=n.call(t,o)}catch(t){i=[6,t],r=0}finally{e=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},r=function(){function r(){var t=this;this.getCars=function(r,a){return n(t,void 0,void 0,(function(){var t,n;return e(this,(function(e){switch(e.label){case 0:return[4,fetch("".concat(this.garageURL,"?_page=").concat(r,"&_limit=").concat(a))];case 1:return t=e.sent(),n={},[4,t.json()];case 2:return[2,(n.cars=e.sent(),n.total=Number(t.headers.get("X-Total-Count")),n)]}}))}))},this.getCar=function(r){return n(t,void 0,void 0,(function(){return e(this,(function(t){switch(t.label){case 0:return[4,fetch("".concat(this.garageURL,"/").concat(r))];case 1:return[2,t.sent().json()]}}))}))},this.createCar=function(a){return n(t,void 0,void 0,(function(){return e(this,(function(t){switch(t.label){case 0:return[4,fetch(this.garageURL,{method:r.HTTPMethods.post,body:JSON.stringify(a),headers:{"Content-Type":r.contentTypes.applicationJson}})];case 1:return t.sent(),[2]}}))}))},this.removeCar=function(a){return n(t,void 0,void 0,(function(){return e(this,(function(t){switch(t.label){case 0:return[4,fetch("".concat(this.garageURL,"/").concat(a),{method:r.HTTPMethods.delete})];case 1:return t.sent(),[2]}}))}))},this.updateCar=function(a,i){return n(t,void 0,void 0,(function(){return e(this,(function(t){switch(t.label){case 0:return[4,fetch("".concat(this.garageURL,"/").concat(a),{method:r.HTTPMethods.put,body:JSON.stringify(i),headers:{"Content-Type":r.contentTypes.applicationJson}})];case 1:return t.sent(),[2]}}))}))},this.generateCars=function(){return n(t,void 0,void 0,(function(){var t=this;return e(this,(function(a){switch(a.label){case 0:return[4,Promise.all(r.makeCars().map((function(r){return n(t,void 0,void 0,(function(){return e(this,(function(t){return[2,this.createCar(r)]}))}))})))];case 1:return a.sent(),[2]}}))}))},this.startEngine=function(a){return n(t,void 0,void 0,(function(){return e(this,(function(t){switch(t.label){case 0:return[4,fetch("".concat(this.engineURL,"?id=").concat(a,"&status=").concat(r.engineStatuses.started),{method:r.HTTPMethods.patch})];case 1:return[2,t.sent().json()]}}))}))},this.stopEngine=function(a){return n(t,void 0,void 0,(function(){return e(this,(function(t){switch(t.label){case 0:return[4,fetch("".concat(this.engineURL,"?id=").concat(a,"&status=").concat(r.engineStatuses.stopped),{method:r.HTTPMethods.patch})];case 1:return[2,t.sent().json()]}}))}))},this.moveCar=function(a){return n(t,void 0,void 0,(function(){var t;return e(this,(function(n){switch(n.label){case 0:return[4,fetch("".concat(this.engineURL,"?id=").concat(a,"&status=").concat(r.engineStatuses.drive),{method:r.HTTPMethods.patch}).catch()];case 1:return[2,(t=n.sent()).status===r.statuses.success?t.json():{success:!1}]}}))}))},this.getWinners=function(r,a,i,o){return void 0===i&&(i="time"),void 0===o&&(o="asc"),n(t,void 0,void 0,(function(){var t,n;return e(this,(function(e){switch(e.label){case 0:return[4,fetch("".concat(this.winnerURL,"?_page=").concat(r,"&_limit=").concat(a,"&_sort=").concat(i,"&_order=").concat(o))];case 1:return t=e.sent(),n={},[4,t.json()];case 2:return[2,(n.winners=e.sent(),n.total=Number(t.headers.get("X-Total-Count")),n)]}}))}))},this.getWinner=function(r){return n(t,void 0,void 0,(function(){return e(this,(function(t){switch(t.label){case 0:return[4,fetch("".concat(this.winnerURL,"/").concat(r))];case 1:return[2,t.sent().json()]}}))}))},this.createWinner=function(a){return n(t,void 0,void 0,(function(){return e(this,(function(t){switch(t.label){case 0:return[4,fetch(this.winnerURL,{method:r.HTTPMethods.post,body:JSON.stringify(a),headers:{"Content-Type":r.contentTypes.applicationJson}})];case 1:return t.sent(),[2]}}))}))},this.removeWinner=function(a){return n(t,void 0,void 0,(function(){return e(this,(function(t){switch(t.label){case 0:return[4,fetch("".concat(this.winnerURL,"/").concat(a),{method:r.HTTPMethods.delete})];case 1:return t.sent(),[2]}}))}))},this.updateWinner=function(a,i){return n(t,void 0,void 0,(function(){return e(this,(function(t){switch(t.label){case 0:return[4,fetch("".concat(this.winnerURL,"/").concat(a),{method:r.HTTPMethods.put,body:JSON.stringify(i),headers:{"Content-Type":r.contentTypes.applicationJson}})];case 1:return t.sent(),[2]}}))}))},this.saveWinner=function(a){var i=a.id,o=a.time;return n(t,void 0,void 0,(function(){var t;return e(this,(function(n){switch(n.label){case 0:return[4,fetch("".concat(this.winnerURL,"/").concat(i))];case 1:return n.sent().status!==r.statuses.notFound?[3,3]:[4,this.createWinner({id:i,wins:1,time:o})];case 2:return n.sent(),[3,6];case 3:return[4,this.getWinner(i)];case 4:return t=n.sent(),[4,this.updateWinner(i,{id:i,wins:t.wins+1,time:o<t.time?o:t.time})];case 5:n.sent(),n.label=6;case 6:return[2]}}))}))},this.serverURL="http://127.0.0.1:3000/",this.garageURL="".concat(this.serverURL,"garage"),this.engineURL="".concat(this.serverURL,"engine"),this.winnerURL="".concat(this.serverURL,"winners")}return r.numCarsToGenerate=100,r.engineStatuses={started:"started",drive:"drive",stopped:"stopped"},r.HTTPMethods={get:"GET",post:"POST",put:"PUT",patch:"PATCH",delete:"DELETE"},r.contentTypes={applicationJson:"application/json"},r.statuses={success:200,notFound:404},r.makeCars=function(){for(var n=[],e=0;e<r.numCarsToGenerate;e+=1){for(var a=t.models[Math.floor(Math.random()*t.models.length)],i=t.makes[Math.floor(Math.random()*t.makes.length)],o="0123456789ABCDEF",s="#",c=0;c<6;c+=1)s+=o[Math.floor(Math.random()*o.length)];n.push({name:"".concat(a," ").concat(i),color:s})}return n},r}();const a=r;function i(t,n,e,r){void 0===e&&(e=""),void 0===r&&(r="");var a=document.createElement(n);return a.className=e,a.textContent=r,t&&t.append(a),a}const o=function(t){var n=this;this.renderCar=function(t){void 0===t&&(t=!0);var e=i(null,"div","car__icon_container");i(e,"div","car__inner-layer"),t&&(e.id="car_".concat(n.carObject.id));var r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttribute("class","icon car__icon"),r.style.fill=n.carObject.color;var a=document.createElementNS("http://www.w3.org/2000/svg","use");return a.setAttributeNS("http://www.w3.org/1999/xlink","href","./img/sprite.svg#car"),r.append(a),e.append(r),e},this.carObject=t};const s=function(){function t(){var n=this;this.renderGarage=function(e,r){n.garageContainer.innerHTML="",e.append(n.garageContainer),i(n.garageContainer,"div","create-tools_container").append(n.createCarTextInput,n.createCarColorInput,n.createCarButton);var a=i(n.garageContainer,"div","update-tools_container");n.updateCarTextInput.disabled=!0,n.updateCarColorInput.disabled=!0,n.updateCarButton.disabled=!0,a.append(n.updateCarTextInput,n.updateCarColorInput,n.updateCarButton),n.createCarTextInput.type="text",n.updateCarTextInput.type="text",n.createCarColorInput.type="color",n.updateCarColorInput.type="color",i(n.garageContainer,"h2","title title__total","Garage (".concat(r,")")),i(n.garageContainer,"h3","title title__page","Page #".concat(n.pageCount));var o=i(n.garageContainer,"div","action_button_container");n.resetButton.disabled=!0,o.append(n.raceButton,n.resetButton,n.generateButton);var s=1===n.pageCount;n.backButton.disabled=!!s,r<=t.carsPerPage*n.pageCount?n.nextButton.disabled=!0:n.nextButton.disabled=!1,n.garageContainer.append(n.carControlsContainer),i(n.garageContainer,"div","nav-buttons_container").append(n.backButton,n.nextButton)},this.renderCarContainers=function(t){return e=n,r=void 0,i=function(){var n=this;return function(t,n){var e,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=n.call(t,o)}catch(t){i=[6,t],r=0}finally{e=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,(function(e){switch(e.label){case 0:return this.carControlsContainer.innerHTML="",[4,t];case 1:return e.sent().cars.forEach((function(t){return n.renderCarContainer(t)})),[2]}}))},new((a=void 0)||(a=Promise))((function(t,n){function o(t){try{c(i.next(t))}catch(t){n(t)}}function s(t){try{c(i.throw(t))}catch(t){n(t)}}function c(n){var e;n.done?t(n.value):(e=n.value,e instanceof a?e:new a((function(t){t(e)}))).then(o,s)}c((i=i.apply(e,r||[])).next())}));var e,r,a,i},this.renderCarContainer=function(t){var e=i(n.carControlsContainer,"div","container"),r=i(e,"div","car__controls");i(r,"button","car__button_select","SELECT").id="button_select_".concat(t.id),i(r,"button","car__button_remove","REMOVE").id="button_remove_".concat(t.id),i(r,"span","car__span_name",t.name);var a=i(e,"div","car__track_container");i(a,"button","button button_engine button_start","A").id="button_start_".concat(t.id);var s=i(a,"button","button button_engine button_stop","B");s.id="button_stop_".concat(t.id),s.disabled=!0;var c=i(a,"div","car__track");c.append(new o(t).renderCar()),i(c,"h3","title__winner","").id="announcement_".concat(t.id);var u=i(c,"div","flag__icon_container");u.id="flag_".concat(t.id),i(u,"img","flag__icon").src="./img/checkerboard.svg"},this.garageContainer=i(null,"div","garage-container"),this.createCarTextInput=i(null,"input","input__text"),this.createCarColorInput=i(null,"input","input__color"),this.createCarButton=i(null,"button","button button_create","CREATE"),this.updateCarTextInput=i(null,"input","input__text"),this.updateCarColorInput=i(null,"input","input__color"),this.carControlsContainer=i(null,"div","car__objects_container"),this.updateCarButton=i(null,"button","button","UPDATE"),this.raceButton=i(null,"button","button button_race","RACE"),this.resetButton=i(null,"button","button_reset","RESET"),this.generateButton=i(null,"button","button button_generate","GENERATE CARS"),this.backButton=i(null,"button","button button_back_garage","BACK"),this.nextButton=i(null,"button","button button_next_garage","NEXT"),this.pageCount=1}return t.carsPerPage=7,t}();var c=function(){function t(){var n=this;this.renderWinners=function(e,r){n.winnersContainer.innerHTML="",e.append(n.winnersContainer),i(n.winnersContainer,"h2","title title__total","Winners (".concat(r,")")),i(n.winnersContainer,"h3","title title__page","Page #".concat(n.pageCount));var a=1===n.pageCount;n.backButton.disabled=!!a,r<=t.winnersPerPage*n.pageCount?n.nextButton.disabled=!0:n.nextButton.disabled=!1,n.winnersContainer.append(n.winnersTableContainer),i(n.winnersContainer,"div","nav-buttons_container").append(n.backButton,n.nextButton)},this.renderTable=function(e,r){return a=n,s=void 0,u=function(){var n,a,s=this;return function(t,n){var e,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=n.call(t,o)}catch(t){i=[6,t],r=0}finally{e=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,(function(c){return this.winnersTableContainer.innerHTML="",n=i(this.winnersTableContainer,"table","winners__table"),a=i(n,"thead","winners__thead"),i(a,"th","winners__column_number","Number"),i(a,"th","winners__column_car","Car"),i(a,"th","winners__column_name","Name"),i(a,"th","winners__column_wins").append(this.winsSortButton),i(a,"th","winners__column_time").append(this.timeSortButton),e.forEach((function(e,a){var c=i(n,"tr");i(c,"td","winners__cell winners__cell_number","".concat(a+(s.pageCount-1)*t.winnersPerPage+1));var u=i(c,"td","winners__cell winners__cell_car"),l=new o(r[a]).renderCar(!1);l.className="winners__logo_container",u.append(l),i(c,"td","winners__cell winners__cell_name","".concat(r[a].name)),i(c,"td","winners__cell winners__cell_wins","".concat(e.wins)),i(c,"td","winners__cell winners__cell_time","".concat(e.time))})),[2]}))},new((c=void 0)||(c=Promise))((function(t,n){function e(t){try{i(u.next(t))}catch(t){n(t)}}function r(t){try{i(u.throw(t))}catch(t){n(t)}}function i(n){var a;n.done?t(n.value):(a=n.value,a instanceof c?a:new c((function(t){t(a)}))).then(e,r)}i((u=u.apply(a,s||[])).next())}));var a,s,c,u},this.winnersContainer=i(null,"div","winners__container"),this.winnersTableContainer=i(null,"div","winners__table_container"),this.backButton=i(null,"button","button button_back_winners","BACK"),this.nextButton=i(null,"button","button button_next_winners","NEXT"),this.winsSortButton=i(null,"button","button button_wins","Wins"),this.timeSortButton=i(null,"button","button button_time","Time↑"),this.pageCount=1}return t.winnersPerPage=10,t}();const u=c;var l=function(t,n,e,r){return new(e||(e=Promise))((function(a,i){function o(t){try{c(r.next(t))}catch(t){i(t)}}function s(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var n;t.done?a(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(o,s)}c((r=r.apply(t,n||[])).next())}))},d=function(t,n){var e,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=n.call(t,o)}catch(t){i=[6,t],r=0}finally{e=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},h=function(t,n,e){if(e||2===arguments.length)for(var r,a=0,i=n.length;a<i;a++)!r&&a in n||(r||(r=Array.prototype.slice.call(n,0,a)),r[a]=n[a]);return t.concat(r||Array.prototype.slice.call(n))},p=function(){function t(n,e,r,a,i){var o=this;this.startApp=function(){o.page.renderHeader(),o.page.renderMain(),o.selectView()},this.selectView=function(){o.page.toGarageButton.addEventListener("click",o.showGarage),o.page.toWinnersButton.addEventListener("click",o.showWinners),o.addListeners(),o.initPage()},this.initPage=function(){o.renderUpdatedCars(),o.renderUpdatedWinners(),o.winners.winnersContainer.style.display="none"},this.showGarage=function(){o.garage.garageContainer.style.display="flex",o.winners.winnersContainer.style.display="none",o.page.toGarageButton.disabled=!0,o.page.toWinnersButton.disabled=!1},this.showWinners=function(){o.renderUpdatedWinners(),o.garage.garageContainer.style.display="none",o.winners.winnersContainer.style.display="flex",o.page.toGarageButton.disabled=!1,o.page.toWinnersButton.disabled=!0},this.addListeners=function(){o.garage.createCarButton.addEventListener("click",o.createCar),o.garage.updateCarButton.addEventListener("click",o.updateCar),o.page.main.addEventListener("click",o.handleEventsOnMain)},this.handleEventsOnMain=function(t){return l(o,void 0,void 0,(function(){var n,e;return d(this,(function(r){switch(r.label){case 0:return(n=t.target).classList.contains("car__button_select")?(this.selectCar(t),[3,10]):[3,1];case 1:return n.classList.contains("car__button_remove")?(this.removeCar(t),[3,10]):[3,2];case 2:return n.classList.contains("button_next_garage")?(this.garage.pageCount+=1,this.renderUpdatedCars(),this.garage.raceButton.disabled=!1,[3,10]):[3,3];case 3:return n.classList.contains("button_back_garage")?(this.garage.pageCount-=1,this.renderUpdatedCars(),[3,10]):[3,4];case 4:return n.classList.contains("button_generate")?(this.connector.generateCars(),this.renderUpdatedCars(),[3,10]):[3,5];case 5:return n.classList.contains("button_start")?(e=Number(n.id.split("button_start_")[1]),this.start(e),[3,10]):[3,6];case 6:return n.classList.contains("button_stop")?(e=Number(n.id.split("button_stop_")[1]),this.stop(e),[3,10]):[3,7];case 7:return n.classList.contains("button_race")?[4,this.handleRaceButton()]:[3,9];case 8:return r.sent(),[3,10];case 9:n.classList.contains("button_reset")?this.reset():n.classList.contains("button_next_winners")?(this.winners.pageCount+=1,this.renderUpdatedWinners()):n.classList.contains("button_back_winners")?(this.winners.pageCount-=1,this.renderUpdatedWinners()):n.classList.contains("button_wins")?this.sortBy("wins",n):n.classList.contains("button_time")&&this.sortBy("time",n),r.label=10;case 10:return[2]}}))}))},this.selectCar=function(t){return l(o,void 0,void 0,(function(){var n;return d(this,(function(e){switch(e.label){case 0:return this.carId=Number(t.target.id.split("button_select_")[1]),[4,this.connector.getCar(this.carId)];case 1:return n=e.sent(),this.garage.updateCarTextInput.value=n.name,this.garage.updateCarColorInput.value=n.color,this.garage.updateCarTextInput.disabled=!1,this.garage.updateCarColorInput.disabled=!1,this.garage.updateCarButton.disabled=!1,[2]}}))}))},this.createCar=function(){return l(o,void 0,void 0,(function(){var t;return d(this,(function(n){switch(n.label){case 0:return t={name:this.garage.createCarTextInput.value,color:this.garage.createCarColorInput.value},[4,this.connector.createCar(t)];case 1:return n.sent(),this.renderUpdatedCars(),[2]}}))}))},this.updateCar=function(){return l(o,void 0,void 0,(function(){var t;return d(this,(function(n){switch(n.label){case 0:return t={name:this.garage.updateCarTextInput.value,color:this.garage.updateCarColorInput.value},[4,this.connector.updateCar(this.carId,t)];case 1:return n.sent(),[4,this.renderUpdatedCars()];case 2:return n.sent(),this.garage.updateCarTextInput.disabled=!0,this.garage.updateCarColorInput.disabled=!0,this.garage.updateCarTextInput.value="",this.garage.updateCarColorInput.value="#000000",this.garage.updateCarButton.disabled=!0,[2]}}))}))},this.removeCar=function(t){return l(o,void 0,void 0,(function(){var n;return d(this,(function(e){switch(e.label){case 0:return n=Number(t.target.id.split("button_remove_")[1]),[4,this.connector.removeCar(n)];case 1:return e.sent(),this.renderUpdatedCars(),[2]}}))}))},this.renderUpdatedCars=function(){return l(o,void 0,void 0,(function(){var t;return d(this,(function(n){switch(n.label){case 0:return[4,this.state.updateStateCars(this.connector.getCars(this.garage.pageCount,s.carsPerPage))];case 1:return n.sent(),[4,this.state.cars];case 2:return t=n.sent().total,this.garage.renderGarage(this.page.main,t),[4,this.garage.renderCarContainers(this.state.cars)];case 3:return n.sent(),[2]}}))}))},this.renderUpdatedWinners=function(){return l(o,void 0,void 0,(function(){var t,n,e,r,a,i=this;return d(this,(function(o){switch(o.label){case 0:return[4,this.state.updateStateWinners(this.connector.getWinners(this.winners.pageCount,u.winnersPerPage,this.state.sortBy,this.state.sortOrder))];case 1:return o.sent(),[4,this.state.winners];case 2:return t=o.sent(),n=t.winners,e=t.total,this.winners.renderWinners(this.page.main,e),r=n.map((function(t){return i.connector.getCar(t.id)})),[4,Promise.all(r)];case 3:return a=o.sent(),this.winners.renderTable(n,a),[2]}}))}))},this.start=function(n){return l(o,void 0,void 0,(function(){var e,r,a,i,o,s,c,u,l,h;return d(this,(function(d){switch(d.label){case 0:return e=document.getElementById("button_start_".concat(n)),r=document.getElementById("button_stop_".concat(n)),e.disabled=!0,r.disabled=!1,[4,this.connector.startEngine(n)];case 1:return a=d.sent(),i=a.velocity,o=a.distance,s=Math.round(o/i),c=document.getElementById("car_".concat(n)),u=document.getElementById("flag_".concat(n)),l=t.getDistanceBetweenElements(c,u)+Number(u.style.width),this.animationID=t.animateCar(c,l,s),[4,this.connector.moveCar(n)];case 2:return(h=d.sent().success)||window.cancelAnimationFrame(this.animationID.id),[2,{success:h,id:n,time:s}]}}))}))},this.stop=function(t){return l(o,void 0,void 0,(function(){var n,e;return d(this,(function(r){switch(r.label){case 0:return n=document.getElementById("car_".concat(t)),e=document.getElementById("button_start_".concat(t)),document.getElementById("button_stop_".concat(t)).disabled=!0,[4,this.connector.stopEngine(t)];case 1:return r.sent(),n.style.transform="translateX(0)",this.animationID&&window.cancelAnimationFrame(this.animationID.id),e.disabled=!1,[2]}}))}))},this.handleRaceButton=function(){return l(o,void 0,void 0,(function(){var t,n,e,r;return d(this,(function(a){switch(a.label){case 0:return this.garage.raceButton.disabled=!0,[4,this.race()];case 1:return t=a.sent(),[4,this.connector.saveWinner(t)];case 2:return a.sent(),n=document.getElementById("announcement_".concat(t.id)),e=n,r="".concat,[4,this.connector.getCar(t.id)];case 3:return e.textContent=r.apply("",[a.sent().name," won in "]).concat(t.time,"s!"),n.style.display="block",this.garage.resetButton.disabled=!1,[2]}}))}))},this.race=function(){return l(o,void 0,void 0,(function(){var t,n,e,r,a=this;return d(this,(function(i){switch(i.label){case 0:return[4,this.state.cars];case 1:return t=i.sent().cars.map((function(t){return a.start(t.id)})),e=this.raceAll,r=[t],[4,this.state.cars];case 2:return n=e.apply(this,r.concat([i.sent().cars.map((function(t){return t.id}))])),[2,n]}}))}))},this.raceAll=function(t,n){return l(o,void 0,void 0,(function(){var e,r,a,i,o,s,c,u;return d(this,(function(l){switch(l.label){case 0:return[4,Promise.race(t)];case 1:return e=l.sent(),r=e.success,a=e.id,i=e.time,r?(u={},[4,this.state.cars]):(o=n.findIndex((function(t){return t===a})),s=h(h([],t.slice(0,o),!0),t.slice(o+1,t.length),!0),c=h(h([],n.slice(0,o),!0),n.slice(o+1,n.length),!0),[2,this.raceAll(s,c)]);case 2:return u.id=l.sent().cars.find((function(t){return t.id===a})).id,u.time=Number((i/1e3).toFixed(2)),[2,u]}}))}))},this.reset=function(){return l(o,void 0,void 0,(function(){var t=this;return d(this,(function(n){switch(n.label){case 0:return this.garage.resetButton.disabled=!0,[4,this.state.cars];case 1:return n.sent().cars.forEach((function(n){return t.stop(n.id)})),Array.from(document.querySelectorAll(".title__winner")).forEach((function(t){t.style.display="none"})),this.garage.raceButton.disabled=!1,[2]}}))}))},this.sortBy=function(t,n){return l(o,void 0,void 0,(function(){var e;return d(this,(function(r){switch(r.label){case 0:return e=n,this.winners.winsSortButton.textContent="Wins",this.winners.timeSortButton.textContent="Time",this.state.sortOrder="asc"===this.state.sortOrder?"desc":"asc",this.state.sortBy=t,e.textContent+="asc"===this.state.sortOrder?"↑":"↓",[4,this.renderUpdatedWinners()];case 1:return r.sent(),[2]}}))}))},this.page=n,this.connector=e,this.garage=r,this.winners=a,this.state=i,this.carId=0,this.animationID={id:0}}return t.animateCar=function(t,n,e){var r=t,a=0,i={id:0},o=function(t){a||(a=t);var s=t-a,c=Math.round(s/e*n);r.style.transform="translateX(".concat(Math.min(c,n),"px)"),c<n&&(i.id=window.requestAnimationFrame(o))};return i.id=window.requestAnimationFrame(o),i},t.getPositionAtCenter=function(t){var n=t.getBoundingClientRect(),e=n.top;return{x:n.left+n.width/2,y:e+n.height/2}},t.getDistanceBetweenElements=function(n,e){var r=t.getPositionAtCenter(n),a=t.getPositionAtCenter(e);return Math.hypot(r.x-a.x,r.y-a.y)},t}();const f=p;var g=function(t,n,e,r){return new(e||(e=Promise))((function(a,i){function o(t){try{c(r.next(t))}catch(t){i(t)}}function s(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var n;t.done?a(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(o,s)}c((r=r.apply(t,n||[])).next())}))},b=function(t,n){var e,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=n.call(t,o)}catch(t){i=[6,t],r=0}finally{e=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};const v=function(t,n){var e=this;this.updateStateCars=function(t){return g(e,void 0,void 0,(function(){return b(this,(function(n){switch(n.label){case 0:return[4,this.cars=t];case 1:return n.sent(),[2]}}))}))},this.updateStateWinners=function(t){return g(e,void 0,void 0,(function(){return b(this,(function(n){switch(n.label){case 0:return[4,this.winners=t];case 1:return n.sent(),[2]}}))}))},this.cars=t,this.winners=n,this.sortBy="time",this.sortOrder="asc"};var w=new function(){var t=this;this.renderHeader=function(){var n=i(document.body,"header","header");i(n,"h1","title title__main","Async Race"),i(n,"div","view__button_container").append(t.toGarageButton,t.toWinnersButton),t.toGarageButton.disabled=!0},this.renderMain=function(){document.body.append(t.main)},this.resetMain=function(){t.main.innerHTML=""},this.toGarageButton=i(null,"button","button header__button","TO GARAGE"),this.toWinnersButton=i(null,"button","button header__button","TO WINNERS"),this.main=i(null,"main","main")},_=new a,C=new s,m=new u,y=new v(_.getCars(C.pageCount,s.carsPerPage),_.getWinners(m.pageCount,u.winnersPerPage));new f(w,_,C,m,y).startApp()})();